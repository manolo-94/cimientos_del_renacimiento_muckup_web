<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cimientos del Renacimiento</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />


  <!-- Datatable CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <style>
    :root {
      --color-vino: #901b45;
      --color-mostaza: #c6943d;
      --color-fondo: #fef9ec;
    }

    * {
      box-sizing: border-box;
      font-family: "Montserrat", sans-serif;
    }

    body {
      margin: 0;
      background: var(--color-fondo);
      color: #333;
    }

    h2.centrado {
      text-align: center;
    }

    header {
      background: var(--color-fondo);
      color: white;
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    header nav a {
      color: var(--color-vino);
      text-decoration: none;
      margin-left: 1.5rem;
      font-weight: bold;
      z-index: 1000;
    }

    .hero {
      width: 100vw;
      height: 100vh;
      background: url("src/img/portada.png") center/cover no-repeat;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .hero h1 {
      font-size: 3rem;
      margin-top: 2rem;
      color: var(--color-vino);
      background: white;
      padding: 0.5rem 1rem;
      border-radius: 1rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    section:not(.hero) {
      padding: 4rem 2rem;
      max-width: 1200px;
      margin: auto;
    }

    .map-section {
      height: 80vh;
      padding: 0;
      position: relative;
    }

    #map {
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    .info.legend {
      background: rgba(255, 255, 255, 0.8);
      padding: 6px;
      border-radius: 4px;
      z-index: 10;
    }

    .filter-container {
      position: absolute;
      
      right: 35px;
      z-index: 10;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    #clear-filters {
      margin-top: 10px;
      background-color: var(--color-vino);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    #clear-filters:hover {
      background-color: #6d1233;
    }

    .ejes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .card {
      background: white;
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card h3 {
      color: var(--color-vino);
    }

    .card p {
      color: #333;
    }

    .transparencia {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
    }

    .transparencia-img {
      width: 100%;
      height: 250px;
      object-fit: cover;
      border-radius: 1rem;
    }

    footer {
      background: var(--color-vino);
      color: white;
      text-align: center;
      padding: 2rem;
    }

    h2 {
      color: var(--color-mostaza);
    }

    .scroll-down {
      position: absolute;
      bottom: 20px;
      font-size: 2rem;
      color: black;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(10px);
      }
    }

    @media (min-aspect-ratio: 16/9) {
      .hero {
        background-size: contain;
      }
    }

    .entidades-section {
      padding: 4rem 2rem;
      background-color: #fef9ec;
      text-align: center;
    }

    .entidades-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .entidad-card {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .entidad-card:hover {
      transform: translateY(-5px);
    }

    .entidad-card img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      margin-bottom: 1rem;
    }

    .entidad-card h3 {
      color: var(--color);
      margin-bottom: 1rem;
    }

    .barra {
      width: 100%;
      background: #eee;
      border-radius: 8px;
      overflow: hidden;
      height: 12px;
      margin-bottom: 0.5rem;
    }

    .progreso {
      height: 100%;
      background: var(--color);
      width: 0;
      transition: width 1.5s ease-out;
    }

    .centrado {
      text-align: center;
    }

    .swiper {
      width: 100%;
      height: 300px;
    }

    .swiper {
      width: 100%;
      height: 300px;
    }

    .swiper-slide img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    #button-primary-custom {
      margin-top: 10px;
      background-color: var(--color-vino);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    #button-primary-custom:hover {
      background-color: #6d1233;
    }

    .custom-cluster-vino {
      background: radial-gradient(circle at 30% 30%, rgba(144, 27, 69, 0.9), rgba(144, 27, 69, 0.7));
      border-radius: 20px; /* no 50% para evitar círculo perfecto */
      color: white;
      text-align: center;
      font-weight: bold;
      line-height: 40px;
      width: 40px;
      height: 40px;
      border: 2px solid #fff;
      box-shadow:
        inset 0 0 5px rgba(0, 0, 0, 0.2),
        0 2px 8px rgba(0, 0, 0, 0.3);
      opacity: 0.95;
    }
    
    
    .custom-cluster-mostaza {
      background-color: var(--color-mostaza);
      border-radius: 50%;
      color: white;
      text-align: center;
      font-weight: bold;
      line-height: 40px;
      width: 40px;
      height: 40px;
      border: 2px solid var(--color-fondo);
      box-shadow: 0 0 5px #0003;
    }
    
    /* Galería en el popup */
.popup-gallery {
  display: flex;
  overflow-x: auto;
  gap: 5px;
  padding: 5px 0;
}
.popup-gallery img {
  width: 70px;
  height: 70px;
  object-fit: cover;
  border-radius: 4px;
  cursor: pointer;
  border: 1px solid #ccc;
}

/* Lightbox modal */
#lightbox {
  position: fixed;
  z-index: 9999;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.85);
  display: flex;
  align-items: center;
  justify-content: center;
}
#lightbox img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 8px;
  box-shadow: 0 0 10px #000;
}

    
  </style>
</head>

<body>
  <header>
    <div style="display: flex; align-items: center; gap: 1rem">
      <img src="src/img/logo-yucatan.png" alt="Escudo de Yucatán" style="height: 50px" />
      <!-- <strong>Cimientos del Renacimiento</strong> -->
    </div>
    <nav>
      <a href="#inicio">Inicio</a>
      <a href="#fideicomiso">¿Qué es fidecomiso?</a>
      <a href="#ejes">Ejes de trabajo</a>
      <a href="#avance">Avance por entidad</a>
      <a href="#mapa">Mapa de obra pública georefereciada</a>
      <a href="#municipios">Municipios con obras</a>
      <a href="#transparencia">Transparencia</a>
    </nav>
  </header>

  <section id="inicio" class="hero">
    <!-- <h1>Cimientos del Renacimiento</h1> -->
    <div class="scroll-down">&#8595;</div>
  </section>

  <section id="fideicomiso">
    <h2 class="centrado">¿Qué es fidecomiso?</h2>
    <p>
      Un fideicomiso o fidecomiso también conocido como fondo fiduciario,
      es un contrato en virtud del cual una o más personas (fideicomitente/s o fiduciante/s) transmiten bienes,
      cantidades de dinero o derechos, presentes o futuros,
      de su propiedad a otra persona (fiduciaria, que puede ser una persona física o jurídica) para que ésta administre
      o invierta los bienes en beneficio propio o en beneficio de un tercero,
      llamado beneficiario
    </p>
  </section>

  <section id="ejes">
    <h2 class="centrado">Ejes de trabajo</h2>
    <div class="ejes-grid">
      <div class="card">
        <h3>Formación Técnica y Profesionalización</h3>
        <p>
          Impulsa el desarrollo de habilidades y competencias en los
          trabajadores mediante capacitaciones, certificaciones y programas de
          educación técnica.
        </p>
      </div>
      <div class="card">
        <h3>Seguridad Laboral en Obra</h3>
        <p>
          Promueve entornos seguros en el trabajo, con protocolos de
          prevención, equipos adecuados y capacitación constante en normas de
          seguridad.
        </p>
      </div>
      <div class="card">
        <h3>Prevención de Addicciones y Salud Mental</h3>
        <p>
          Fomenta el bienestar integral con campañas de concientización, apoyo
          psicológico y acciones para prevenir adicciones en entornos
          laborales.
        </p>
      </div>
      <div class="card">
        <h3>Acompañamiento y Bienestar Familiar e Infantil</h3>
        <p>
          Brinda apoyo a las familias de los trabajadores mediante programas
          de desarrollo infantil, asistencia educativa y servicios integrales
          de bienestar.
        </p>
      </div>
      <div class="card">
        <h3>Transparencia y Rendición de Cuentas</h3>
        <p>
          Garantiza el acceso a información clara y pública sobre el uso de
          recursos, avances de obra y resultados, promoviendo la confianza
          ciudadana.
        </p>
      </div>
    </div>
  </section>

  <section id="avance" class="entidades-section">
    <h2>Avance por Entidad</h2>
    <div class="entidades-grid">
      <!-- Tarjeta por entidad -->
      <div class="entidad-card" style="--color: orange">
        <img src="src/img/logo.png" alt="IDEFEEY Logo" />
        <h3>IDEFEEY</h3>
        <div class="barra">
          <div class="progreso" style="width: 75%"></div>
        </div>
        <p>75% completado</p>
      </div>

      <div class="entidad-card" style="--color: green">
        <img src="src/img/logo.png" alt="INCAY Logo" />
        <h3>INCAY</h3>
        <div class="barra">
          <div class="progreso" style="width: 60%"></div>
        </div>
        <p>60% completado</p>
      </div>

      <div class="entidad-card" style="--color: yellow">
        <img src="src/img/logo.png" alt="INCAY Logo" />
        <h3>INCCOPY</h3>
        <div class="barra">
          <div class="progreso" style="width: 50%"></div>
        </div>
        <p>50% completado</p>
      </div>

      <div class="entidad-card" style="--color: PURPLE">
        <img src="src/img/logo.png" alt="INCAY Logo" />
        <h3>IVEY</h3>
        <div class="barra">
          <div class="progreso" style="width: 60%"></div>
        </div>
        <p>60% completado</p>
      </div>

      <div class="entidad-card" style="--color: RED">
        <img src="src/img/logo.png" alt="INCAY Logo" />
        <h3>JAPAY</h3>
        <div class="barra">
          <div class="progreso" style="width: 80%"></div>
        </div>
        <p>80% completado</p>
      </div>

      <!-- Añade los demás igual -->
    </div>
  </section>

  <section id="mapa" class="map-section">
    <h2 class="centrado">Mapa de Obra Pública Georefereciada</h2>
    <!--<h2
        style="
          text-align: center;
          padding: 1rem 0;
          background: white;
          margin: 0;
        "
      >
        Mapa de Obras del Fideicomiso
      </h2> -->
    <div class="filter-container">
      <!--
        <label>
          Entidad:
          <select id="filtro-entidad">
            <option value="todos">Todos</option>
            <option>IDEFEEY</option>
            <option>INCAY</option>
            <option>INCCOPY</option>
            <option>IVEY</option>
            <option>JAPAY</option>
          </select>
        </label>
        -->
      <br />
      <label>
        Municipio:
        <select id="filtro-municipio">
          <option value="todos">Todos</option>
        </select>
      </label>
      <br />
      <!--
        <label>
          Estatus:
          <select id="filtro-estatus">
            <option value="todos">Todos</option>
            <option value="finalizada">Finalizada</option>
            <option value="proceso">En proceso</option>
            <option value="planeacion">Planeación</option>
          </select>
         
        </label>
        -->
      <button id="clear-filters">Borrar filtros</button>
    </div>

    <div id="map"></div>

    <!-- Lightbox modal -->
<div id="lightbox" style="display:none;" onclick="closeLightbox()">
  <img id="lightbox-img" />
</div>
  </section>

  <!-- Sección: Galería + Mapa + Descripción -->
  <section id="municipios">
    <h2 class="centrado">Municipios con Obras</h2>
    <!--
    <div class="table-responsive" style="overflow-x: auto;">
      <table id="municipiosTable" class="display nowrap" style="width:100%">
        <thead>
          <tr>
            <th>Municipio</th>
            <th>Tipo de Obra</th>
            <th>Fecha</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          
          <tr>
            <td>Mérida</td>
            <td>Rehabilitación de parque</td>
            <td>2024-05-12</td>
            <td><button class="ver-detalle" data-muni="Mérida">Ver Detalle</button></td>
          </tr>
          <tr>
            <td>Progreso</td>
            <td>Pavimentación de calles</td>
            <td>2024-04-20</td>
            <td><button class="ver-detalle" data-muni="Progreso">Ver Detalle</button></td>
          </tr>
          
        </tbody>
      </table>
    </div>

    <div id="detalleModal"
      style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); z-index:9999; justify-content:center; align-items:center;">
      <div style="background:white; padding:2rem; border-radius:1rem; max-width:90%; max-height:90%; overflow:auto;">
        <button onclick="cerrarModal()"
          style="float:right; background:red; color:white; border:none; padding:5px 10px; cursor:pointer;">Cerrar</button>
        <h3 id="modalTitle"></h3>
        <p><strong>Descripción:</strong> <span id="modalDescripcion"></span></p>
        <div id="galeria" style="display:flex; gap:1rem; flex-wrap:wrap;">
          
        </div>
      </div>
    </div>

  -->
    <div class="table-responsive" style="overflow-x: auto;">
      <table id="tablaMunicipios" class="display nowrap" style="width:100%">
        <thead>
          <tr>
            <th>Municipio</th>
            <th>Total de Obras</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Modal para mostrar obras -->
    <div class="modal fade" id="modalObras" tabindex="-1">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Obras en <span id="modalMunicipio"></span></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <ul id="listaObras" class="list-group"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para detalle de obra -->
    <div class="modal fade" id="modalDetalleObra" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="detalleNombre"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p><strong>Municipio:</strong> <span id="detalleMunicipio"></span></p>
            <p><strong>Inversión:</strong> $ <span id="detalleInversion"></span> millones</p>
            <p><strong>Ejecutora:</strong> <span id="detalleEntidad"></span></p>
            <p><strong>Avance:</strong> <span id="detalleAvance"></span>%</p>
            <p><strong>Descripción:</strong> <span id="detalleDescripcion"></span></p>

            <div class="swiper mySwiper">
              <div class="swiper-wrapper" id="swiper-wrapper">
                <!-- Aquí se insertarán las imágenes como .swiper-slide -->
              </div>
              <div class="swiper-button-next"></div>
              <div class="swiper-button-prev"></div>
              <div class="swiper-pagination"></div>
            </div>


          </div>
        </div>
      </div>
    </div>

  </section>


  <section id="transparencia">
    <h2 class="centrado">Transparencia</h2>
    <div class="transparencia">
      <div>
        <img src="src/img/reportes.png" alt="Reporte" class="transparencia-img" />
        <p>Accede a reportes trimestrales y documentación oficial.</p>
      </div>
      <div>
        <img src="src/img/auditores.jpg" alt="Auditoría" class="transparencia-img" />
        <p>Auditorías públicas disponibles para descarga.</p>
      </div>
    </div>
  </section>

  <footer>
    <p>&copy; 2025 Cimientos del Renacimiento | Gobierno de Yucatán</p>
  </footer>

  <!-- Aquí insertas tu script de mapa actual -->
  <!-- LIBRERÍAS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/lottie-web@latest/build/player/lottie.min.js"></script>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>


  <!--Bootstrap-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!--jQuery-->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

  <!-- DataTables CDN -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

  <!-- SCRIPT JS PRINCIPAL -->
  <script src="src/index.js"></script>
</body>

</html>

<script>

  let swiperInstance;

  $(document).ready(function () {

    let municipiosSet = new Set();
    let municipioLayers = {};
    let municipiosData = []; // Aquí guardaremos municipios + obras

    fetch("yucatan_municipios_2023.json")
      .then((res) => res.json())
      .then((data) => {
        L.geoJSON(data, {

          onEachFeature: (feature, layer) => {
            const municipio = feature.properties.NOMGEO;

            // Generar obras fake para este municipio
            const obras = generarObrasFake().map((obra, i) => ({
              ...obra,
              id: i + 1,
              municipio
            }));

            municipiosData.push({ municipio, obras });
          }
        });

        llenarTablaMunicipios(); // Llamamos a esta función después de cargar y procesar los municipios
      });

    function generarObrasFake() {
      const AVANCE = Math.floor(Math.random() * 100) + 1;
      const INVERSION = Math.floor(Math.random() * 1000000) + 1;
      const ESTATUS = ['Planeada', 'En proceso', 'Finalizada'];
      const ENTIDADES = ['IDEFEEY', 'INCAY', 'INCCOPYl', 'IVEY', 'JAPAY'];
      const cantidad = Math.floor(Math.random() * 4) + 1; // 1 a 4 obras
      return Array.from({ length: cantidad }).map((_, i) => ({
        nombre: `Obra demo #${i + 1}`,
        entidad: ENTIDADES[Math.floor(Math.random() * ENTIDADES.length)],
        estatus: ESTATUS[Math.floor(Math.random() * ESTATUS.length)],
        avance: AVANCE,
        inversion: INVERSION,
        descripcion: 'Descripción simulada de una obra pública en el municipio.',
        fotos: [
          'https://placehold.co/600x400?text=Obra+1',
          'https://placehold.co/600x400?text=Obra+2',
          'https://placehold.co/600x400?text=Obra+3'
        ]
      }));
    }

    // Elimina acentos y normaliza caracteres para el filtro de busqueda en la tabla de municipios
    jQuery.fn.DataTable.ext.type.search.string = function (data) {
      return !data
        ? ''
        : typeof data === 'string'
          ? data.normalize('NFD').replace(/[\u0300-\u036f]/g, '')
          : data;
    };

    function llenarTablaMunicipios() {
      const tabla = $('#tablaMunicipios').DataTable({
        data: municipiosData.map(m => ({
          municipio: m.municipio,
          totalObras: m.obras.length,
          acciones: `<button id="button-primary-custom" class="btn btn-primary btn-sm ver-obras" data-municipio="${m.municipio}">Ver Obras</button>`
        })),
        columns: [
          { data: 'municipio' },
          { data: 'totalObras' },
          { data: 'acciones' }
        ]
      });

      $('#tablaMunicipios tbody').on('click', '.ver-obras', function () {
        const municipio = $(this).data('municipio');
        const municipioData = municipiosData.find(m => m.municipio === municipio);

        $('#modalMunicipio').text(municipio);
        const listaObras = $('#listaObras').empty();
        municipioData.obras.forEach(obra => {
          listaObras.append(`<li class="list-group-item obra-link" data-id="${obra.id}" data-mun="${municipio}">${obra.nombre}</li>`);
        });
        new bootstrap.Modal('#modalObras').show();
      });

      $(document).on('click', '.obra-link', function () {
        const obraId = $(this).data('id');
        const municipio = $(this).data('mun');
        const obra = municipiosData.find(m => m.municipio === municipio).obras.find(o => o.id === obraId);
    
        $('#detalleNombre').text(obra.nombre);
        $('#detalleMunicipio').text(obra.municipio);
        $('#detalleInversion').text(obra.inversion);
        $('#detalleEntidad').text(obra.entidad);
        $('#detalleAvance').text(obra.avance);
        $('#detalleDescripcion').text(obra.descripcion);
    
        const swiperWrapper = $('#swiper-wrapper').empty();
        obra.fotos.forEach(f => {
          swiperWrapper.append(`<div class="swiper-slide"><img src="${f}" alt="foto de obra"></div>`);
        });
    
        if (swiperInstance) {
          swiperInstance.destroy(true, true);
        }
        
        swiperInstance = new Swiper('.swiper', {
          loop: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev'
          }
        });
        
    
        new bootstrap.Modal('#modalDetalleObra').show();
      });
    }
  });

</script>